<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>John Marians</title>
    <meta name="theme-color" content="#557bfe">


    <!-- unicon  -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <!-- style -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    
    <main>

        <!-- shimmer -->
        <div class="shimmer"></div>
        <!-- shimmer close -->

        <!-- sidemenu  -->
        <div class="sidemenu">
            <div class="closeSidemenu"><i class="uil uil-multiply"></i></div>
            <div class="sidemenuProfile">
                <a href="login.html" class="sidemenuLoginBtn">Login</a>
            </div>
            <div class="sidemenuBody">
                <ul>
                    <li>
                        <a href="index.html" class="sidemenuLinkActive"><span><i class="uil uil-estate"></i></span> <p>Home</p></a>
                    </li>
                    <li>
                        <a href="contact.html"><span><i class="uil uil-headphones"></i></span> <p>Contact</p></a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- sidemenu close -->

        <!-- nav  -->
        <nav>
            <div class="container">
                <a href="index.html" class="navLogo">
                    <img src="assets/images/johnmariansLogo.png" alt="John Marians Logo">
                </a>
                <div class="navBar">
                    <div class="navBarBox">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </nav>
        <!-- nav close -->

        <!-- form section  -->
        <section id="formSection">
            <div class="container">
                <div class="formSectionMain">
                    <div class="form">
                        <h1>Enter OTP</h1>
                        <p>OTP send to <span id="otp_send_number"></span></p>
                        <form action="">
                            <div class="otpField">
                                <input type="number" maxlength="1" class="otpnum1"/>
                                <input type="number" maxlength="1" class="otpnum2"/>
                                <input type="number" maxlength="1" class="otpnum3"/>
                                <input type="number" maxlength="1" class="otpnum4"/>
                                <input type="number" maxlength="1" class="otpnum5"/>
                                <input type="number" maxlength="1" class="otpnum6"/>
								
                            </div>
							<span class="otp_error_msg" style="color:red"></span>
                            <div class="forgtPsd">
                                <p>Didn't recieve code ? <a href="" id="request_again">Request agin</a>
                                </p>
                            </div>
                            <button class="verifyOtpBtn disabledBtn">Verify</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <!-- form section close -->

        <!-- footer  -->
        <footer class="foot2">
            <div class="container">
                <div class="footerMain">
                    <div class="footerStripRights">
                        <p>Â© 2022, All Rights Reserved.</p>
                    </div>
                    <div class="footerStripCreat">
                        <p>Designed with <i class="uil uil-heart"></i><a href="https://esightsolutions.com/" target="_blank">Esight Solutions</a></p>
                    </div>
                </div>
            </div>
        </footer>
        <!-- footer close -->

    </main>


    <!-- jquery  -->
    <script src="assets/js/jquery.js"></script>
    <!-- fontawesome -->
    <script src="https://kit.fontawesome.com/4022a59704.js" crossorigin="anonymous"></script>
    <!-- main -->
    <script src="assets/js/main.js"></script>

    <script>

        $('.verifyOtpBtn').click(function(e){
            e.preventDefault();
        });

        // otp verification 
        const inputs = document.querySelectorAll(".otpField input");
        inputs.forEach((input, index) => {
            input.dataset.index = index;
            input.addEventListener("paste", handleOnPasteOtp);
            input.addEventListener("keyup", handleOtp);
        });
        function handleOtp(e) {
            /**
             * <input type="text" ðŸ‘‰ maxlength="1" />
             * ðŸ‘‰ NOTE: On mobile devices `maxlength` property isn't supported,
             * So we to write our own logic to make it work. ðŸ™‚
             */
            const input = e.target;
            let value = input.value;
            input.value = "";
            input.value = value ? value[0] : "";

            let fieldIndex = input.dataset.index;
            if (value.length > 0 && fieldIndex < inputs.length - 1) {
                input.nextElementSibling.focus();
            }

            if (e.key === "Backspace" && fieldIndex > 0) {
                input.previousElementSibling.focus();
            }
			console.log(fieldIndex)
            if (fieldIndex == inputs.length - 1) {
                submit();
            }
        }

        function handleOnPasteOtp(e) {
            const data = e.clipboardData.getData("text");
            const value = data.split("");
            if (value.length === inputs.length) {
                inputs.forEach((input, index) => (input.value = value[index]));
                submit();
            }
        }
		$.ajax({
			url:"action/registration/fetch_phn.php",
			success:function(result_data){
				if(result_data != undefined){
					$('#otp_send_number').text(result_data)
				}else{
					window.location.herf="mobile-verification.html"
				}
			}
		})

        function submit() {
            console.log("Submitting...");
            // ðŸ‘‡ Entered OTP
            let otp = "";
            inputs.forEach((input) => {
                otp += input.value;
               // input.disabled = true;
                //input.classList.add("disabled");
            });
            $('.verifyOtpBtn').removeClass('disabledBtn');

            $('.verifyOtpBtn').click(function(e){
                e.preventDefault();
				$('.otp_error_msg').text('')
				let otp1 = $('.otpnum1').val()
				let otp2 = $('.otpnum2').val()
				let otp3 = $('.otpnum3').val()
				let otp4 = $('.otpnum4').val()
				let otp5 = $('.otpnum5').val()
				let otp6 = $('.otpnum6').val()
				let otp = otp1+otp2+otp3+otp4+otp5+otp6
				$.ajax({
					url:"action/registration/varify_otp.php",
					type:"POST",
					data:{otp:otp},
					success:function(otp_result){
						console.log(otp_result)
						if(otp_result == 1){
							$('.verifyOtpBtn').text('Success')
							$('.verifyOtpBtn').css('background-color','blue')
							window.location = 'register.html'
						}else if(otp_result == 2){
							$('.otp_error_msg').text('Invalid OTP')
						}else if(otp_result == 0){
							window.location.href="mobile-verification.html"
						}
					}
				})
                //window.location = 'register.html'
            });
            console.log(otp);
            // ðŸ‘‰ Call API below
        }
		$('#request_again').click(function(e){
			e.preventDefault()
			$.ajax({
				url:"action/registration/resent_otp.php",
				success:function(result_data){
					if(result_data == 1){
						window.location.reload()
					}else{
						window.location.href="mobile-verification.html"
					}
				}
			})
		})
        
    </script>

</body>
</html>